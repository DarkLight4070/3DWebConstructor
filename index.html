<html>
	<head>
	    <title>3D Web Constructor</title>
	    <link rel="stylesheet" type="text/css" href="extjs/resources/css/ext-all.css">
    	<script type="text/javascript" src="extjs/ext-all.js"></script>

    	<!-- Babylon.js -->
    	<script src="babylon/hand.minified-1.2.js"></script>
        <script src="babylon/cannon.js"></script>
        <script src="babylon/oimo.js"></script>
		<script src="https://cdn.babylonjs.com/babylon.js"></script>
		<script src="babylon/OBJFileLoader.js"></script>
		<script src="babylon/editcontrol.js"></script>
		
		<script src="babylon/SceneManager.js"></script>
		<script src="babylon/SelectionManager.js"></script>
		<script src="babylon/UiManager.js"></script>
		<script src="babylon/event_emitter.js"></script>
		<script src="babylon/ShaderBuilder.js"></script>
		
		<style>
			.visible-icon
			{
				background-image: url('icons/visible.png') !important;
			}
			.hidden-icon
			{
				background-image: url('icons/hidden.png') !important;
			}
			.wireframe-icon
			{
				background-image: url('icons/wireframe.png') !important;
			}
			.plain-icon
			{
				background-image: url('icons/plain.png') !important;
			}
		</style>
		
	</head>
	<body>
		<script type="text/javascript">
			
			var uiManager = null;
			var sceneManager = null;
			var treeStore = null;

			const emmiter = new EventEmitter();

			function updateSelectionSpacialAttributes(__selection)
			{

				if(selectionMode == vertexSelectionMode)
				{
					var positions = lastPickedMesh.getVerticesData(BABYLON.VertexBuffer.PositionKind);
					//mesh.data = {type: 'VERTEX_OBJECT', vertexIndex: i, mesh: lastPickedMeshMaterial}
					positions[__selection.data.vertexIndex] = Ext.getCmp('pXId').getValue();
					positions[__selection.data.vertexIndex + 1] = Ext.getCmp('pYId').getValue();
					positions[__selection.data.vertexIndex + 2] = Ext.getCmp('pZId').getValue();
					for(var i = 0; i < lastPickedMesh.data.vertexMeshs.length; i++)
					{
						var vertexMesh = lastPickedMesh.data.vertexMeshs[i];
						if(vertexMesh.data.vertexIndex != __selection.data.vertexIndex)
						{
							//console.log('S Position: ' + __selection.position);
							//console.log('V Position: ' + vertexMesh.position);
							if(vertexMesh.position.x == __selection.position.x && vertexMesh.position.y == __selection.position.y && vertexMesh.position.z == __selection.position.z)
							{
								positions[vertexMesh.data.vertexIndex] = Ext.getCmp('pXId').getValue();
								positions[vertexMesh.data.vertexIndex + 1] = Ext.getCmp('pYId').getValue();
								positions[vertexMesh.data.vertexIndex + 2] = Ext.getCmp('pZId').getValue();
								vertexMesh.position.x = Ext.getCmp('pXId').getValue();
								vertexMesh.position.y = Ext.getCmp('pYId').getValue();
								vertexMesh.position.z = Ext.getCmp('pZId').getValue();
							}
						}
					}
					var positionFunction = function(__positions) {
						__positions = positions;
					};
					lastPickedMesh.updateMeshPositions(positionFunction, true);
					lastPickedMesh.refreshBoundingInfo();

				}

				

			}

			function UI_CreateNumberField(__label, __id, __defaultValue)
			{
				return Ext.create('Ext.form.field.Number', {
					fieldLabel: __label,
					id: __id,
					value: __defaultValue
				});
			}

			function updateMeshSpacialAttributesFromUi(__mesh)
			{
				__mesh.position.x = Ext.getCmp('xId').getValue();
				__mesh.position.y = Ext.getCmp('yId').getValue();
				__mesh.position.z = Ext.getCmp('zId').getValue();

				__mesh.rotation.x = Ext.getCmp('rXId').getValue() * (Math.PI / 180);
				__mesh.rotation.y = Ext.getCmp('rYId').getValue() * (Math.PI / 180);
				__mesh.rotation.z = Ext.getCmp('rZId').getValue() * (Math.PI / 180);
			}

			Ext.require([
			    'Ext.tree.*',
			    'Ext.data.*',
			    'Ext.tip.*'
			]);

			Ext.onReady(function()
			{
				
				Ext.QuickTips.init();
				
				var prefabsStore = Ext.create('Ext.data.Store', {
				    fields: 
				    ['id', 'name'],
				    data : 
				    [
				    	{"id": "Line", "name": "Line"},
				    	{"id": "Plane", "name": "Plane"},
				        {"id": "Box", "name": "Box"},
				        {"id": "Sphere", "name": "Sphere"},
				        {"id": "Cylinder", "name": "Cylinder"}
				    ]
				});
				
				var coStore = Ext.create('Ext.data.Store', {
				    fields: 
				    ['id', 'name'],
				    data : 
				    [
				    	{"id": "sub", "name": "Substruct"},
				    	{"id": "union", "name": "Union"},
				        {"id": "intersect", "name": "Intersect"}
				    ]
				});
				
				Ext.create('Ext.panel.Panel', {
				    width: '100%',
					height: '100%',
				    title: '3D Web Constructor',
				    layout: 'border',
				    items:
				    [
						{
							title: 'Tools',
							region: 'east',
							xtype: 'tabpanel',
							tabPosition: 'right',
							id: 'toolsTabPanelId',
							width: 300,
							split: false,
							margins: '0 0 0 0',
							collapsible: true,
							layout: 'fit',
							items: 
							[
								{
									title: 'Properties',
									layout: 'fit',
									height: '100%',
									items: 
									[
										{
											xtype: 'form',
											bodyPadding: 5,
											layout: 'anchor',
											defaults: 
											{
												anchor: '100%'
											},
											items: 
											[
												{
													xtype:'fieldset',
													title: 'Position',
													id: 'selectionPropertiesPositionFieldSet',
													defaults: 
													{
														anchor: '100%'
													},
													defaultType: 'numberfield',
													layout: 'anchor',
													items :
													[
														{
															xtype: 'numberfield',
															fieldLabel: 'X',
															value: 0,
															id: 'pXId'
														},
														{
															xtype: 'numberfield',
															fieldLabel: 'Y',
															value: 0,
															id: 'pYId'
														},
														{
															xtype: 'numberfield',
															fieldLabel: 'Z',
															value: 0,
															id: 'pZId'
														}
													]
												},
												{
													xtype:'fieldset',
													title: 'Rotation',
													id: 'selectionPropertiesRotationFieldSet',
													defaults: 
													{
														anchor: '100%'
													},
													defaultType: 'numberfield',
													layout: 'anchor',
													items :
													[
														{
															xtype: 'numberfield',
															fieldLabel: 'X',
															value: 0,
															id: 'pRXId'
														},
														{
															xtype: 'numberfield',
															fieldLabel: 'Y',
															value: 0,
															id: 'pRYId'
														},
														{
															xtype: 'numberfield',
															fieldLabel: 'Z',
															value: 0,
															id: 'pRZId'
														}
													]
												}
											],
											buttons: 
											[
												{
													text: 'Update',
													handler: function()
													{
														var x = Ext.getCmp('pXId').getValue();
														var y = Ext.getCmp('pYId').getValue();
														var z = Ext.getCmp('pZId').getValue();

														var xr = Ext.getCmp('pRXId').getValue();
														var yr = Ext.getCmp('pRYId').getValue();
														var zr = Ext.getCmp('pRZId').getValue();
														emmiter.emit('APPLY_TRANSFORMATION_TO_SELECTION', x, y, z, xr, yr, zr);
													}
												}
											]
										}
									]
								}, 
								{
									title: 'Prefabs Factory',
									layout: 'fit',
									height: '100%',
									items: 
									[
										{
											xtype: 'form',
											bodyPadding: 5,
											layout: 'anchor',
											defaults: 
											{
												anchor: '100%'
											},
											items: 
											[
												{
													xtype:'fieldset',
													title: 'Prefab Type',
													defaults: 
													{
														anchor: '100%'
													},
													layout: 'anchor',
													items :
													[
														{
															xtype: 'combo',
															fieldLabel: 'Type',
															store: prefabsStore,
															queryMode: 'local',
															displayField: 'name',
															valueField: 'id',
															listeners:
															{
																change: 
																{

																	fn: function(_this, newValue, oldValue, eOpts)
																	{
																		console.log(newValue);
																		uiManager.buildPrefabEntriesUi(newValue);
																	}
																}
															}
														}
													]
												},
												{
													xtype:'fieldset',
													title: 'Position',
													id: 'prefabPositionFieldSet',
													defaults: 
													{
														anchor: '100%'
													},
													defaultType: 'numberfield',
													layout: 'anchor',
													items :
													[
														{
															xtype: 'numberfield',
															fieldLabel: 'X',
															value: 0,
															id: 'xId'
														},
														{
															xtype: 'numberfield',
															fieldLabel: 'Y',
															value: 0,
															id: 'yId'
														},
														{
															xtype: 'numberfield',
															fieldLabel: 'Z',
															value: 0,
															id: 'zId'
														}
													]
												},
												{
													xtype:'fieldset',
													title: 'Rotation',
													id: 'prefabRotationFieldSet',
													defaults: 
													{
														anchor: '100%'
													},
													defaultType: 'numberfield',
													layout: 'anchor',
													items :
													[
														{
															xtype: 'numberfield',
															fieldLabel: 'X',
															value: 0,
															id: 'rXId'
														},
														{
															xtype: 'numberfield',
															fieldLabel: 'Y',
															value: 0,
															id: 'rYId'
														},
														{
															xtype: 'numberfield',
															fieldLabel: 'Z',
															value: 0,
															id: 'rZId'
														}
													]
												},
												{
													xtype:'fieldset',
													title: 'Prefab properties',
													id: 'prefabParamsFieldSet',
													defaults: 
													{
														anchor: '100%'
													},
													defaultType: 'numberfield',
													layout: 'anchor',
													items :
													[
													]
												}
											],
											buttons: 
											[
												{
													text: 'Reset',
													handler: function() 
													{
													}
												}, 
												{
													text: 'Create',
													handler: function()
													{
														console.log(' Creation Handler handler called');
														prefabCreationFunction();
													}
												}
											]
										}
									]
								},
								{
									title: 'Compound Objects',
									layout: 'fit',
									id: 'coTabId',
									height: '100%',
									items: 
									[
										{
											xtype: 'form',
											bodyPadding: 5,
											layout: 'anchor',
											defaults: 
											{
												anchor: '100%'
											},
											items: 
											[
												{
													xtype:'fieldset',
													title: 'Objects',
													defaults: 
													{
														anchor: '100%'
													},
													layout: 'anchor',
													items :
													[
														{
															xtype: 'textfield',
															fieldLabel: 'First Object',
															id: 'firstObjectId'
														},
														{
															xtype: 'textfield',
															fieldLabel: 'Second Object',
															id: 'secondObjectId'
														}
													]
												},
												{
													xtype:'fieldset',
													title: 'Options',
													defaults: 
													{
														anchor: '100%'
													},
													layout: 'anchor',
													items :
													[
														{
															xtype: 'combo',
															fieldLabel: 'Type',
															store: coStore,
															queryMode: 'local',
															displayField: 'name',
															valueField: 'id',
															id: 'coTypeId'
														},
														{
															xtype: 'checkboxfield',
															fieldLabel: 'Delete objects',
															id: 'coDeleteObjectsId'
														}
													]
												}
											],
											buttons: 
											[
												{
													text: 'Reset',
													handler: function() 
													{
													}
												}, 
												{
													text: 'Create',
													handler: function()
													{
														var operationType = Ext.getCmp('coTypeId').getValue();
														var deleteObjs = Ext.getCmp('coDeleteObjectsId').getValue();
														emmiter.emit('EXECUTE_CO', operationType, deleteObjs);
													}
												}
											]
										}
									]
								},							
								{
									title: '3D Section',
									layout: 'fit',
									id: 'sectionTabId',
									disabled: true,
									height: '100%',
									items: 
									[
										{
											xtype: 'form',
											bodyPadding: 5,
											layout: 'anchor',
											defaults: 
											{
												anchor: '100%'
											},
											items: 
											[
												{
													xtype:'fieldset',
													title: 'Config',
													defaults: 
													{
														anchor: '100%'
													},
													layout: 'anchor',
													items :
													[
														{
															xtype: 'sliderfield',
															fieldLabel: 'X',
															id: 'sectionXPositionId',
															value: 0,
															increment: 1,
															minValue: -100,
															maxValue: 100,
															listeners:
															{
																change:
																{
																	fn: function(slider, newValue, thumb, eOpts)
																	{
																		sceneManager.selectionManager.lastPickedMesh.material.setFloat("xlimit", newValue / 100);
																	}
																}
															}
														},
														{
															xtype: 'sliderfield',
															fieldLabel: 'Y',
															id: 'sectionYPositionId',
															value: 0,
															increment: 1,
															minValue: -100,
															maxValue: 100,
															listeners:
															{
																change:
																{
																	fn: function(slider, newValue, thumb, eOpts)
																	{
																		sceneManager.selectionManager.lastPickedMesh.material.setFloat("ylimit", newValue / 100);
																	}
																}
															}
														},
														{
															xtype: 'sliderfield',
															fieldLabel: 'Z',
															id: 'sectionZPositionId',
															value: 0,
															increment: 1,
															minValue: -100,
															maxValue: 100,
															listeners:
															{
																change:
																{
																	fn: function(slider, newValue, thumb, eOpts)
																	{
																		sceneManager.selectionManager.lastPickedMesh.material.setFloat("zlimit", newValue / 100);
																	}
																}
															}
														}
													]
												}
											],
											buttons: 
											[
												{
													text: 'Reset',
													handler: function() 
													{
													}
												}, 
												{
													text: 'Create',
													handler: function()
													{
														var operationType = Ext.getCmp('coTypeId').getValue();
														var deleteObjs = Ext.getCmp('coDeleteObjectsId').getValue();
														emmiter.emit('EXECUTE_CO', operationType, deleteObjs);
													}
												}
											]
										}
									]
								}
							]
						},
						{
							title: '3D View',
							region: 'center',
							xtype: 'panel',
							margins: '0 0 0 0',
							html: '<canvas id="renderCanvas" style="width:100%;height:100%;" touch-action="none"></canvas>',
							tbar: 
							[
								{
									xtype: 'buttongroup',
									columns: 3,
									defaults: 
									{
										scale: 'small'
									},
									items:
									[
										{
											xtype: 'button',
											id: 'translateButton',
											enableToggle: true,
											toggleGroup: 'transformGroup',
											tooltip: 'Translate',
											icon: 'icons/translate.png',
											toggleHandler: function (button, state) 
											{
												if(state)
												{
													sceneManager.selectionManager.transform = 't';
												}
												else
												{
													sceneManager.selectionManager.transform = '';
												}
										
											}
										},
										{
											xtype: 'button',
											enableToggle: true,
											toggleGroup: 'transformGroup',
											tooltip: 'Rotate',
											icon: 'icons/rotate.png',
											id: 'rotateButton',
											toggleHandler: function (button, state) 
											{
												if(state)
												{
													sceneManager.selectionManager.transform = 'r';
													console.log(sceneManager.selectionManager.transform);
												}
												else
												{
													sceneManager.selectionManager.transform = '';
												}
											}
										},
										{
											xtype: 'button',
											enableToggle: true,
											toggleGroup: 'transformGroup',
											tooltip: 'Scale',
											icon: 'icons/scale.png',
											toggleHandler: function (button, state) 
											{
												if(state)
												{
													sceneManager.selectionManager.transform = 's';
												}
												else
												{
													sceneManager.selectionManager.transform = '';
												}
											}
										}
									]
								},
								{
									xtype: 'buttongroup',
									columns: 2,
									defaults: 
									{
										scale: 'small'
									},
									items:
									[
										{
											xtype: 'button',
											enableToggle: true,
											tooltip: 'Enable Compound Objects Mode',
											icon: 'icons/co.png',
											id: 'enableCOModeButtonId',
											listeners:
											{
												toggle:
												{
													fn: function( __this, pressed, eOpts )
													{
														emmiter.emit('ENABLE_CO_MODE', pressed);
													}
												}
											}
										},
										{
											xtype: 'button',
											enableToggle: true,
											tooltip: 'Enable 3D Section Mode',
											icon: 'icons/section.png',
											id: 'enableSectionModeButtonId',
											listeners:
											{
												toggle:
												{
													fn: function( __this, pressed, eOpts )
													{
														if(sceneManager.selectionManager.lastPickedMesh == null)
														{
															Ext.MessageBox.alert('3D Section', 'Please select an object !');
															Ext.getCmp('enableSectionModeButtonId').toggle(false, true);
															return;
														}
														
														emmiter.emit('ENABLE_SECTION_MODE', pressed);
														
														if(pressed == true)
														{
															Ext.getCmp('sectionTabId').setDisabled(false);
															Ext.getCmp('toolsTabPanelId').setActiveTab(Ext.getCmp('sectionTabId'));
															var bboxInfo = sceneManager.selectionManager.lastPickedMesh.getBoundingInfo()
															bboxInfo.update(sceneManager.selectionManager.lastPickedMesh._worldMatrix);
															var vectors = bboxInfo.boundingBox.vectors; 
															var width = Number(vectors[1].x - vectors[0].x);
															Ext.getCmp('sectionXPositionId').setMaxValue(width * 100 / 2);
															Ext.getCmp('sectionXPositionId').setMinValue(-width * 100 / 2);
															Ext.getCmp('sectionXPositionId').setValue(width * 100 / 2);
															var heigh = Number(vectors[1].y - vectors[0].y);
															Ext.getCmp('sectionYPositionId').setMaxValue(heigh * 100 / 2);
															Ext.getCmp('sectionYPositionId').setMinValue(-heigh * 100 / 2);
															Ext.getCmp('sectionYPositionId').setValue(heigh * 100 / 2);
															var depth = Number(vectors[1].z - vectors[0].z);
															Ext.getCmp('sectionZPositionId').setMaxValue(depth * 100 / 2);
															Ext.getCmp('sectionZPositionId').setMinValue(-depth * 100 / 2);
															Ext.getCmp('sectionZPositionId').setValue(depth * 100 / 2);
														}
														else
														{
															Ext.getCmp('sectionTabId').setDisabled(true);
														}
													}
												}
											}
										}
									]
								},
								{
									xtype: 'buttongroup',
									columns: 3,
									defaults: 
									{
										scale: 'small'
									},
									items:
									[
										{
											xtype: 'button',
											tooltip: 'Import',
											icon: 'icons/import.png',
											handler: function()
											{
												emmiter.emit('MESH_IMPORT');
											}
										},
										{
											xtype: 'button',
											tooltip: 'Clone Selected Mesh',
											icon: 'icons/clone.png',
											handler: function()
											{
												emmiter.emit('CLONE_MESH');
											}
										},
										{
											xtype: 'button',
											tooltip: 'Delete Selected',
											icon: 'icons/delete.png',
											handler: function()
											{
												emmiter.emit('DELETE_SELECTED_MESH');
											}
										}
									]
								},
								{
									xtype: 'buttongroup',
									columns: 2,
									defaults: 
									{
										scale: 'small'
									},
									items:
									[
										{
											xtype: 'button',
											enableToggle: true,
											tooltip: 'Enable Camera Target',
											icon: 'icons/camera_target.png',
											toggleHandler: function (button, state) 
											{
												sceneManager.targetSelection = state;	
											}
										},
										{
											xtype: 'button',
											tooltip: 'Reset Camera position',
											icon: 'icons/reset_camera.png',
											handler: function () 
											{
												emmiter.emit('CHANGE_VIEW', 'FRONT');
											}
										}
									]
								}
							]
						}
			    	],
			    	tbar: 
			    	[
		        		{
		        			xtype: 'button',
		        			text: 'File',
						    menu: 
						    [
						        {
						        	text: 'New Project',
									disabled: true
						        },
						        {
						        	text: 'Load Project',
									disabled: true
						        },
						        {
						        	text: 'Save',
									disabled: true
						        },
						        {
						        	text: 'Export',
									disabled: true
						        }
						    ]
		        		}
				    ],
				    renderTo: Ext.getBody()
				});
				
				var navPanel = Ext.create('Ext.panel.Panel', 
				{
					margins: '5 0 0 0',
					width: 200,
					height: 400,
					collapsible: true,
					collapsed: false,
					floating: true,
					shadow: false,
					id: 'project-structure-navigator',
					layout: 'fit',
					title: '3D Structure',
					layout: 'fit',
					items: 
					[
						{
							xtype: 'treepanel',
							hideHeaders: true,
							id: 'mainTree',
							border: 0,
							width: '100%',
							height: '100%',
							rootVisible: true,
							columns: 
							[
								{
									xtype: 'treecolumn',
									flex: 2,
									sortable: true,
									dataIndex: 'text'
								},
								{
									xtype: 'actioncolumn',
									width: 20,
									items: 
									[
										{
											handler: function(grid, rowIndex, colIndex) 
											{
												var store = grid.getStore();
												var rec = store.getAt(rowIndex);
												rec.raw.object.visibility = !rec.raw.object.visibility;
												if(rec.raw.object.name != 'Grid')
												{
													rec.raw.object.isPickable = rec.raw.object.visibility;
												}
												rec.commit();
											},
											getClass: function(value, metadata, record)
											{
												if(record.raw.object == undefined)
												{
													return '';
												}
												
												if (record.raw.object.visibility == true)
												{
													return 'visible-icon';
												} 
												else if(record.raw.object.visibility == false)
												{
													return 'hidden-icon';
												}
											}
										}
									]
								},
								{
									xtype: 'actioncolumn',
									width: 20,
									items: 
									[
										{
											handler: function(grid, rowIndex, colIndex) 
											{
												var store = grid.getStore();
												var rec = store.getAt(rowIndex);
												var meshName = rec.get('text');
												var mesh = rec.raw.object;
												mesh.material.wireframe = !mesh.material.wireframe;
												mesh.data.originalMaterial.wireframe = mesh.material.wireframe;
												mesh.data.selectionMaterial.wireframe = mesh.material.wireframe;
												if(mesh.material.wireframe == true)
												{
													mesh.disableEdgesRendering();
												}
												else
												{
													sceneManager.enableEdgeMode(mesh);
												}
												rec.commit();
											},
											getClass: function(value, metadata, record)
											{
												var mesh = record.raw.object;
												if(mesh != null && mesh != undefined && mesh.data != undefined && mesh.data.type == 'sceneObject')
												{
													var material = mesh.data.originalMaterial;
													if(material == undefined)
													{
														return 'wireframe-icon';
													}
													
													if(material.wireframe == true)
													{
														return 'plain-icon';
													}
													else
													{
														return 'wireframe-icon';
													}
												}
												return '';
											}
										}
									]
								}
							],
							viewConfig: 
							{
								plugins: 
								{ 
									ptype: 'treeviewdragdrop' 
								}
							},
							listeners: 
							{
								itemclick: 
								{

									fn: function (view, record, item, index, e)
									{
										if(record.parentNode.data.text == 'Meshes')
										{
											var meshName = record.get('text');
											var mesh = sceneManager.scene.getMeshByName(meshName);
											if(mesh.data.originalMaterial == undefined)
											{
												//console.log(mesh.subMeshes[0].getMaterial().name);
												mesh.data.originalMaterial = mesh.material.clone();
											}
											emmiter.emit('SELECT_MESH', mesh);
										}
									}
								}
							}
						}
					],
					tbar: 
					[
						{
							xtype: 'button',
							tooltip: 'Hide all',
							icon: 'icons/hidden.png',
							handler: function () 
							{
								emmiter.emit('MESH_HIDE_ALL');
							}
						},
						{
							xtype: 'tbseparator' 
						},
						{
							xtype: 'button',
							tooltip: 'Show all',
							icon: 'icons/visible.png',
							handler: function () 
							{
								emmiter.emit('MESH_SHOW_ALL');
							}
						},
						{
							xtype: 'tbseparator' 
						},
						{
							xtype: 'button',
							tooltip: 'Wireframe all',
							icon: 'icons/wireframe.png',
							handler: function () 
							{
								emmiter.emit('MESH_WIREFRAME_ALL', true);
							}
						},
						{
							xtype: 'tbseparator' 
						},
						{
							xtype: 'button',
							tooltip: 'Default material for all',
							icon: 'icons/plain.png',
							handler: function () 
							{
								emmiter.emit('MESH_WIREFRAME_ALL', false);
							}
						},
						{
							xtype: 'tbseparator' 
						},
						{
							xtype: 'button',
							tooltip: 'Clear scene',
							icon: 'icons/delete.png',
							handler: function () 
							{
								Ext.Msg.show(
								{
									title:'Clear Scene',
									msg: 'This action will clear the scene ! Do you want to continue ?',
									buttons: Ext.Msg.YESNO,
									icon: Ext.Msg.QUESTION,
									fn: function(btn, text)
									{
										if(btn == 'yes')
										{
											emmiter.emit('SCENE_CLEAR');
										}
									}
								});
							}
						}
					]
				}).show();
				var canvas = Ext.get('renderCanvas');
				var box = canvas.getBox();
				navPanel.setPosition({x: box.x, y: box.y});
				navPanel.setHeight(box.height);
				navPanel.collapse();
				
				sceneManager = new SceneManager();
				sceneManager.create3DScene();				
				uiManager = new UiManager(sceneManager);
				uiManager.updateRootTreeUi();
			});
		</script>

	</body>
</html>
